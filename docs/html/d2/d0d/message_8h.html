<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Thread Synch AOSV 2020: src/message.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Thread Synch AOSV 2020
   </div>
   <div id="projectbrief">LKM for exchange messages between threads</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">message.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handles all procedures releated to messages of a group device.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;linux/init.h&gt;</code><br />
<code>#include &lt;linux/module.h&gt;</code><br />
<code>#include &lt;linux/kernel.h&gt;</code><br />
<code>#include &lt;linux/slab.h&gt;</code><br />
<code>#include &lt;linux/uaccess.h&gt;</code><br />
<code>#include &lt;linux/semaphore.h&gt;</code><br />
<code>#include &lt;linux/proc_fs.h&gt;</code><br />
<code>#include &lt;linux/mutex.h&gt;</code><br />
<code>#include &lt;linux/spinlock.h&gt;</code><br />
<code>#include &lt;linux/atomic.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d49/types_8h_source.html">types.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for message.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/d49/message_8h__incl.png" border="0" usemap="#src_2message_8h" alt=""/></div>
<map name="src_2message_8h" id="src_2message_8h">
<area shape="rect" title="Handles all procedures releated to messages of a group device." alt="" coords="681,5,797,32"/>
<area shape="rect" title=" " alt="" coords="5,80,96,107"/>
<area shape="rect" title=" " alt="" coords="121,80,239,107"/>
<area shape="rect" title=" " alt="" coords="263,80,374,107"/>
<area shape="rect" title=" " alt="" coords="398,80,495,107"/>
<area shape="rect" title=" " alt="" coords="520,80,643,107"/>
<area shape="rect" title=" " alt="" coords="667,80,810,107"/>
<area shape="rect" title=" " alt="" coords="835,80,952,107"/>
<area shape="rect" title=" " alt="" coords="976,80,1088,107"/>
<area shape="rect" title=" " alt="" coords="1111,80,1235,107"/>
<area shape="rect" title=" " alt="" coords="1260,80,1375,107"/>
<area shape="rect" href="../../d9/d49/types_8h.html" title="Defines all structures and global variables needed by the module." alt="" coords="1399,80,1470,107"/>
<area shape="rect" title=" " alt="" coords="905,155,1012,181"/>
<area shape="rect" title=" " alt="" coords="1036,155,1127,181"/>
<area shape="rect" title=" " alt="" coords="1151,155,1265,181"/>
<area shape="rect" title=" " alt="" coords="1290,155,1433,181"/>
<area shape="rect" title=" " alt="" coords="1457,155,1557,181"/>
<area shape="rect" title=" " alt="" coords="1581,155,1685,181"/>
<area shape="rect" title=" " alt="" coords="1709,155,1808,181"/>
<area shape="rect" title=" " alt="" coords="1833,155,1941,181"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d95/message_8h__dep__incl.png" border="0" usemap="#src_2message_8hdep" alt=""/></div>
<map name="src_2message_8hdep" id="src_2message_8hdep">
<area shape="rect" title="Handles all procedures releated to messages of a group device." alt="" coords="27,5,143,32"/>
<area shape="rect" href="../../d4/dbe/group__manager_8h.html" title="Handles all procedures releated to file operation issued on a group device." alt="" coords="5,80,164,107"/>
<area shape="rect" href="../../d2/dac/main__device_8h.html" title="Handles all procedures releated to the main synch device file." alt="" coords="15,155,155,181"/>
<area shape="rect" href="../../d0/dce/src_2main_8c.html" title="Linux Kernel Module for Synchronization." alt="" coords="40,229,129,256"/>
</map>
</div>
</div>
<p><a href="../../d2/d0d/message_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5f8b3637206be36636dd1f76d5f9a864"><td class="memItemLeft" align="right" valign="top"><a id="a5f8b3637206be36636dd1f76d5f9a864"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NO_MSG_PRESENT</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a5f8b3637206be36636dd1f76d5f9a864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341d9ea11c7ed03bca3c5389d45c2c05"><td class="memItemLeft" align="right" valign="top"><a id="a341d9ea11c7ed03bca3c5389d45c2c05"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ALLOC_ERR</b>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:a341d9ea11c7ed03bca3c5389d45c2c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5b435b16787017c5a2c7d05368a056a"><td class="memItemLeft" align="right" valign="top"><a id="aa5b435b16787017c5a2c7d05368a056a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>USER_COPY_ERR</b>&#160;&#160;&#160;-3</td></tr>
<tr class="separator:aa5b435b16787017c5a2c7d05368a056a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8546399aa552226729610f5abd159ef4"><td class="memItemLeft" align="right" valign="top"><a id="a8546399aa552226729610f5abd159ef4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SEM_INIT_ERR</b>&#160;&#160;&#160;-4  /** @brief Semaphore initialization **/</td></tr>
<tr class="separator:a8546399aa552226729610f5abd159ef4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af44b67abea595d0f336c945a4fbe9694"><td class="memItemLeft" align="right" valign="top"><a id="af44b67abea595d0f336c945a4fbe9694"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MSG_INVALID_FORMAT</b>&#160;&#160;&#160;-11</td></tr>
<tr class="separator:af44b67abea595d0f336c945a4fbe9694"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ffe3881a4ad40483ac903626e8827e0"><td class="memItemLeft" align="right" valign="top"><a id="a4ffe3881a4ad40483ac903626e8827e0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MSG_SIZE_ERROR</b>&#160;&#160;&#160;-12</td></tr>
<tr class="separator:a4ffe3881a4ad40483ac903626e8827e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a637db2f9919079c06b987c7595c1411d"><td class="memItemLeft" align="right" valign="top"><a id="a637db2f9919079c06b987c7595c1411d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MEMORY_ERROR</b>&#160;&#160;&#160;-13</td></tr>
<tr class="separator:a637db2f9919079c06b987c7595c1411d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0f7219dee20d955370ee6140e85a94c"><td class="memItemLeft" align="right" valign="top"><a id="ad0f7219dee20d955370ee6140e85a94c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>STORAGE_SIZE_ERR</b>&#160;&#160;&#160;-14</td></tr>
<tr class="separator:ad0f7219dee20d955370ee6140e85a94c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341d9ea11c7ed03bca3c5389d45c2c05"><td class="memItemLeft" align="right" valign="top"><a id="a341d9ea11c7ed03bca3c5389d45c2c05"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ALLOC_ERR</b>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:a341d9ea11c7ed03bca3c5389d45c2c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bd8a296d72c36e23aba0ac4a7adc8be"><td class="memItemLeft" align="right" valign="top"><a id="a4bd8a296d72c36e23aba0ac4a7adc8be"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CLASS_EXISTS</b>&#160;&#160;&#160;-10</td></tr>
<tr class="separator:a4bd8a296d72c36e23aba0ac4a7adc8be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2763801dcd6ebc317c578e813b9d46d2"><td class="memItemLeft" align="right" valign="top"><a id="a2763801dcd6ebc317c578e813b9d46d2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CLASS_ERR</b>&#160;&#160;&#160;-11</td></tr>
<tr class="separator:a2763801dcd6ebc317c578e813b9d46d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a794bbb98bbdfc758e3d658c3a3732589"><td class="memItemLeft" align="right" valign="top"><a id="a794bbb98bbdfc758e3d658c3a3732589"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEV_CREATION_ERR</b>&#160;&#160;&#160;-12</td></tr>
<tr class="separator:a794bbb98bbdfc758e3d658c3a3732589"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b624f0374ac3974af4258411e3691a"><td class="memItemLeft" align="right" valign="top"><a id="a42b624f0374ac3974af4258411e3691a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CDEV_ALLOC_ERR</b>&#160;&#160;&#160;-13</td></tr>
<tr class="separator:a42b624f0374ac3974af4258411e3691a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08ae9c7badcac2d94f0a59844eb6e6cc"><td class="memItemLeft" align="right" valign="top"><a id="a08ae9c7badcac2d94f0a59844eb6e6cc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EMPTY_LIST</b>&#160;&#160;&#160;-20</td></tr>
<tr class="separator:a08ae9c7badcac2d94f0a59844eb6e6cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afba4202ece4ed5d7d638c745202fef9e"><td class="memItemLeft" align="right" valign="top"><a id="afba4202ece4ed5d7d638c745202fef9e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NODE_NOT_FOUND</b>&#160;&#160;&#160;-21</td></tr>
<tr class="separator:afba4202ece4ed5d7d638c745202fef9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3c55ec3c2605319931c8ceab028c84e"><td class="memItemLeft" align="right" valign="top"><a id="ae3c55ec3c2605319931c8ceab028c84e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INVALID_IOCTL_COMMAND</b>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:ae3c55ec3c2605319931c8ceab028c84e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf11ece5e944f4f83bc4847970442ad1"><td class="memItemLeft" align="right" valign="top"><a id="aaf11ece5e944f4f83bc4847970442ad1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CHDEV_ALLOC_ERR</b>&#160;&#160;&#160;-22</td></tr>
<tr class="separator:aaf11ece5e944f4f83bc4847970442ad1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa547f54a7e6b394f9130110aab1faa6b"><td class="memItemLeft" align="right" valign="top"><a id="aa547f54a7e6b394f9130110aab1faa6b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEFAULT_GC_RATIO</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:aa547f54a7e6b394f9130110aab1faa6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae4d4d5142721632ab642b71b7bbdc440"><td class="memItemLeft" align="right" valign="top">msg_manager_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#ae4d4d5142721632ab642b71b7bbdc440">createMessageManager</a> (const u_int _max_storage_size, const u_int _max_message_size, garbage_collector_t *garbageCollector)</td></tr>
<tr class="memdesc:ae4d4d5142721632ab642b71b7bbdc440"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialize all the members of a 'msg_manager_t' struct.  <a href="../../d2/d0d/message_8h.html#ae4d4d5142721632ab642b71b7bbdc440">More...</a><br /></td></tr>
<tr class="separator:ae4d4d5142721632ab642b71b7bbdc440"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba93a9118165a7e11a1b0865f78da85"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#a1ba93a9118165a7e11a1b0865f78da85">writeMessage</a> (msg_t *message, msg_manager_t *manager)</td></tr>
<tr class="memdesc:a1ba93a9118165a7e11a1b0865f78da85"><td class="mdescLeft">&#160;</td><td class="mdescRight">write message on a group queue  <a href="../../d2/d0d/message_8h.html#a1ba93a9118165a7e11a1b0865f78da85">More...</a><br /></td></tr>
<tr class="separator:a1ba93a9118165a7e11a1b0865f78da85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0eb4f46db2a45d736b02c2ac731fdba"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#af0eb4f46db2a45d736b02c2ac731fdba">readMessage</a> (msg_t *dest_buffer, msg_manager_t *manager)</td></tr>
<tr class="memdesc:af0eb4f46db2a45d736b02c2ac731fdba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a message from the corresponding queue.  <a href="../../d2/d0d/message_8h.html#af0eb4f46db2a45d736b02c2ac731fdba">More...</a><br /></td></tr>
<tr class="separator:af0eb4f46db2a45d736b02c2ac731fdba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad117d4757e857e3f53219e970bd4e9ba"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#ad117d4757e857e3f53219e970bd4e9ba">copy_msg_from_user</a> (msg_t *kmsg, const char *umsg, const ssize_t _size)</td></tr>
<tr class="memdesc:ad117d4757e857e3f53219e970bd4e9ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">copy a msg_t structure from user-space to kernel-space  <a href="../../d2/d0d/message_8h.html#ad117d4757e857e3f53219e970bd4e9ba">More...</a><br /></td></tr>
<tr class="separator:ad117d4757e857e3f53219e970bd4e9ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70ecba8a2f8f11a1e058030e522e9d3a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#a70ecba8a2f8f11a1e058030e522e9d3a">copy_msg_to_user</a> (const msg_t *kmsg, __user char *ubuffer, const ssize_t _size)</td></tr>
<tr class="memdesc:a70ecba8a2f8f11a1e058030e522e9d3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">copy a msg_t structure from kernel-space to user-space  <a href="../../d2/d0d/message_8h.html#a70ecba8a2f8f11a1e058030e522e9d3a">More...</a><br /></td></tr>
<tr class="separator:a70ecba8a2f8f11a1e058030e522e9d3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba1d8514abde9dfb52f2fb006fd5dbf1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#aba1d8514abde9dfb52f2fb006fd5dbf1">queueGarbageCollector</a> (struct work_struct *work)</td></tr>
<tr class="memdesc:aba1d8514abde9dfb52f2fb006fd5dbf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a message from the queue when it was completely delivered.  <a href="../../d2/d0d/message_8h.html#aba1d8514abde9dfb52f2fb006fd5dbf1">More...</a><br /></td></tr>
<tr class="separator:aba1d8514abde9dfb52f2fb006fd5dbf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe680d2cb4664ed30117bea22d4733a0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#abe680d2cb4664ed30117bea22d4733a0">isDelaySet</a> (const msg_manager_t *manager)</td></tr>
<tr class="memdesc:abe680d2cb4664ed30117bea22d4733a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the message delay is greater than zero on a group.  <a href="../../d2/d0d/message_8h.html#abe680d2cb4664ed30117bea22d4733a0">More...</a><br /></td></tr>
<tr class="separator:abe680d2cb4664ed30117bea22d4733a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39ccede09c258649eb302c9eae019bfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#a39ccede09c258649eb302c9eae019bfd">delayedMessageCallback</a> (struct timer_list *timer)</td></tr>
<tr class="memdesc:a39ccede09c258649eb302c9eae019bfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when a timer for a delayed message expires.  <a href="../../d2/d0d/message_8h.html#a39ccede09c258649eb302c9eae019bfd">More...</a><br /></td></tr>
<tr class="separator:a39ccede09c258649eb302c9eae019bfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af58ffeb71713f9051b0e065c1aab6318"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#af58ffeb71713f9051b0e065c1aab6318">queueDelayedMessage</a> (msg_t *message, msg_manager_t *manager)</td></tr>
<tr class="memdesc:af58ffeb71713f9051b0e065c1aab6318"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert a delayed message into the pending queue.  <a href="../../d2/d0d/message_8h.html#af58ffeb71713f9051b0e065c1aab6318">More...</a><br /></td></tr>
<tr class="separator:af58ffeb71713f9051b0e065c1aab6318"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0205d35a68e74d35bab2858e077865ae"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#a0205d35a68e74d35bab2858e077865ae">revokeDelayedMessage</a> (msg_manager_t *manager)</td></tr>
<tr class="memdesc:a0205d35a68e74d35bab2858e077865ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove all the delayed message from the queue.  <a href="../../d2/d0d/message_8h.html#a0205d35a68e74d35bab2858e077865ae">More...</a><br /></td></tr>
<tr class="separator:a0205d35a68e74d35bab2858e077865ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03e27c8961ac14bd4453f9d64bf2ae43"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d0d/message_8h.html#a03e27c8961ac14bd4453f9d64bf2ae43">cancelDelay</a> (msg_manager_t *manager)</td></tr>
<tr class="memdesc:a03e27c8961ac14bd4453f9d64bf2ae43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the delay of messages in the delay queue to zero.  <a href="../../d2/d0d/message_8h.html#a03e27c8961ac14bd4453f9d64bf2ae43">More...</a><br /></td></tr>
<tr class="separator:a03e27c8961ac14bd4453f9d64bf2ae43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handles all procedures releated to messages of a group device. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a03e27c8961ac14bd4453f9d64bf2ae43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03e27c8961ac14bd4453f9d64bf2ae43">&#9670;&nbsp;</a></span>cancelDelay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cancelDelay </td>
          <td>(</td>
          <td class="paramtype">msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the delay of messages in the delay queue to zero. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">manager</td><td>The group's message manager</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of messages which delay was cancelled</dd></dl>
<dl class="section note"><dt>Note</dt><dd>At the moment the function locks the delayed queue, set all timers to zero and unlock the queue. This means that while the function loops through the queue, timer's callback will wait since the queue is locked. </dd></dl>

</div>
</div>
<a id="ad117d4757e857e3f53219e970bd4e9ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad117d4757e857e3f53219e970bd4e9ba">&#9670;&nbsp;</a></span>copy_msg_from_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int copy_msg_from_user </td>
          <td>(</td>
          <td class="paramtype">msg_t *&#160;</td>
          <td class="paramname"><em>kmsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>umsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ssize_t&#160;</td>
          <td class="paramname"><em>_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>copy a msg_t structure from user-space to kernel-space </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">kmsg</td><td>Kernel-space msg_t </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">umsg</td><td>User-space msg_t</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>if the copy fails</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000006">Todo:</a></b></dt><dd>Check thread-safety of the function </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The kmsg structure must be allocated </dd></dl>

</div>
</div>
<a id="a70ecba8a2f8f11a1e058030e522e9d3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70ecba8a2f8f11a1e058030e522e9d3a">&#9670;&nbsp;</a></span>copy_msg_to_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int copy_msg_to_user </td>
          <td>(</td>
          <td class="paramtype">const msg_t *&#160;</td>
          <td class="paramname"><em>kmsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__user char *&#160;</td>
          <td class="paramname"><em>ubuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ssize_t&#160;</td>
          <td class="paramname"><em>_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>copy a msg_t structure from kernel-space to user-space </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">kmsg</td><td>Kernel-space msg_t </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">umsg</td><td>User-space buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-EFAULT</td><td>if the copy fails</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000005">Todo:</a></b></dt><dd>Check thread-safety of the function </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The umsg structure must be allocated </dd></dl>

</div>
</div>
<a id="ae4d4d5142721632ab642b71b7bbdc440"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4d4d5142721632ab642b71b7bbdc440">&#9670;&nbsp;</a></span>createMessageManager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">msg_manager_t* createMessageManager </td>
          <td>(</td>
          <td class="paramtype">const u_int&#160;</td>
          <td class="paramname"><em>_max_storage_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const u_int&#160;</td>
          <td class="paramname"><em>_max_message_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">garbage_collector_t *&#160;</td>
          <td class="paramname"><em>garbage_collector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate and initialize all the members of a 'msg_manager_t' struct. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_max_message_size</td><td>Configurable param </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_max_storage_size</td><td>Configurable param </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">garbageCollectorFunction</td><td>Pointer to the work_struct responsible for garbage collection</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">An</td><td>'msg_manager_t' pointer to an allocated an initialized 'msg_manager_t' struct </td></tr>
    <tr><td class="paramname">A</td><td>NULL pointer in case the 'kmalloc' fails </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a39ccede09c258649eb302c9eae019bfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39ccede09c258649eb302c9eae019bfd">&#9670;&nbsp;</a></span>delayedMessageCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delayedMessageCallback </td>
          <td>(</td>
          <td class="paramtype">struct timer_list *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when a timer for a delayed message expires. </p>
<p>The function simply take the existing '<a class="el" href="../../d6/d20/structt__message__delayed__deliver.html" title="Contains a &#39;msg_t&#39; structure and the timer needed to delay the delivery.">t_message_delayed_deliver</a>' structure, extract the 'msg_t' field and write it into the FIFO queue via the 'writeMessage' function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">timer</td><td>The timer that elasped </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>nothing </dd></dl>

</div>
</div>
<a id="abe680d2cb4664ed30117bea22d4733a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe680d2cb4664ed30117bea22d4733a0">&#9670;&nbsp;</a></span>isDelaySet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDelaySet </td>
          <td>(</td>
          <td class="paramtype">const msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the message delay is greater than zero on a group. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">manager</td><td>A pointer to the message manager of the group</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function is thread-safe</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>If the delay is greater than zero </td></tr>
    <tr><td class="paramname">false</td><td>If the delay is zero </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af58ffeb71713f9051b0e065c1aab6318"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af58ffeb71713f9051b0e065c1aab6318">&#9670;&nbsp;</a></span>queueDelayedMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int queueDelayedMessage </td>
          <td>(</td>
          <td class="paramtype">msg_t *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert a delayed message into the pending queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>The message to insert into the queue </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">manager</td><td>A pointer to the current msg_manager_t of the group</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aba1d8514abde9dfb52f2fb006fd5dbf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba1d8514abde9dfb52f2fb006fd5dbf1">&#9670;&nbsp;</a></span>queueGarbageCollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void queueGarbageCollector </td>
          <td>(</td>
          <td class="paramtype">struct work_struct *&#160;</td>
          <td class="paramname"><em>work</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove a message from the queue when it was completely delivered. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">work</td><td>The work struct contained inside "msg_manager_t"</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>nothing</dd></dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000007">Todo:</a></b></dt><dd>Check if size calculation are done correctly</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function has three critical section, therefore it could be a bottleneck of the module </dd></dl>

</div>
</div>
<a id="af0eb4f46db2a45d736b02c2ac731fdba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0eb4f46db2a45d736b02c2ac731fdba">&#9670;&nbsp;</a></span>readMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int readMessage </td>
          <td>(</td>
          <td class="paramtype">msg_t *&#160;</td>
          <td class="paramname"><em>dest_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a message from the corresponding queue. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">1</td><td>if no message is present </td></tr>
    <tr><td class="paramname">-1</td><td>on critical error </td></tr>
  </table>
  </dd>
</dl>
<p>This should't be necessary since the message's sender is automatically added in the list of recipients and, consequently, the 'wasDelivered' function should skip it. However for unknown reason this does not always happens (especially if the message is delayed)</p>
<dl class="bug"><dt><b><a class="el" href="../../de/da5/bug.html#_bug000002">Bug:</a></b></dt><dd>: when 'revoke delay' functionality is called, messages trigger this if and will not be delivered </dd></dl>

</div>
</div>
<a id="a0205d35a68e74d35bab2858e077865ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0205d35a68e74d35bab2858e077865ae">&#9670;&nbsp;</a></span>revokeDelayedMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int revokeDelayedMessage </td>
          <td>(</td>
          <td class="paramtype">msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove all the delayed message from the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">manager</td><td>The message manager of the group</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function is thread safe with respect to the list of delayed message</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The number of delayed messages which revoked </dd></dl>

</div>
</div>
<a id="a1ba93a9118165a7e11a1b0865f78da85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba93a9118165a7e11a1b0865f78da85">&#9670;&nbsp;</a></span>writeMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int writeMessage </td>
          <td>(</td>
          <td class="paramtype">msg_t *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">msg_manager_t *&#160;</td>
          <td class="paramname"><em>manager</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>write message on a group queue </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>The data pointed must never be deallocatated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">manager</td><td>Pointer to the message manager </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">recipients</td><td>The head of the linked list containing the thread recipients</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">STORAGE_SIZE_ERR</td><td>if the message does not respect the group's size limits </td></tr>
    <tr><td class="paramname">ALLOC_ERR</td><td>if some allocation fails</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Must be protected by a write-spinlock to avoid concurrent modification of The recipient data-structure and manager's message queue </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
